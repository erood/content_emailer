extends layout


block content
  //if not signed up, show landing page
  //if signed up, show key stats on home page
  if user
    head
      //jquery
      script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js')
      //moment
      script(src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.js')
      //select2
      <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
      <link href="../css/select2.min.css" rel="stylesheet">
      script.

        $(document).ready(function() {

          //$('.js-example-basic-single_2').select2();

          $('.js-example-basic-single_2').select2({
            //sort the options
            sorter: function(data) {
                return data.sort(function (a, b) {
                    if (a.text > b.text) {
                        return 1;
                    }
                    if (a.text < b.text) {
                        return -1;
                    }
                    return 0;
                });
            }  
          })


        });

        function update_data() {
          document.getElementById("update-form").submit();
        }


        window.onload = function start(){
          //parse the params_json data attached to User model
          var params_json = document.getElementById("params_json").value;
          var params_json_1 = JSON.parse(params_json);
          

          
          //push the User's desired delivery frequency to the selector element
          var frequency = document.getElementById("frequency");
          frequency.value = params_json_1.user.frequency;
          console.log(params_json_1);
          subreddits_stg = params_json_1.user.subreddits;

          //push the User's desired subreddits to the selector element

          //--Create an array from the comma-separated string from JSON parsed data
          var subreddits_stg_2 = subreddits_stg.split(',');

          //--Loop through array, push to selector box
          $.each(subreddits_stg_2, function (i, item) {
              $('#subreddits').append($('<option>', { 
                  value: item,
                  text: item,
                  selected: true

              }));
              
          });



          };




      //link(rel='stylesheet', type='text/css', href='https://cdn.datatables.net/v/bs-3.3.7/jq-2.2.4/dt-1.10.15/b-1.3.1/b-colvis-1.3.1/cr-1.3.3/fc-3.2.2/fh-3.1.2/r-2.1.1/rg-1.0.0/rr-1.2.0/sc-1.4.2/datatables.min.css')      
      .div
        .container
          .row
            .col-md-10-col-md-offset-1(style='text-align:center')
              form.form-horizontal(id='update-form', action='/account/profile', method='POST')
                input(type='hidden', name='_csrf', value=_csrf)
                input(type='hidden', id="params_json", value= JSON.stringify(locals))
                //h3(style="padding-top:10px;") Welcome
                br
                p.paragraph(style='font-size:22px;line-height:1.5;color:#4f4c52;padding-top:5px;') 
                  | Your subreddits

                <select multiple="multiple" class="js-example-basic-single_2" name="subreddits" id="subreddits" style="width:265px;font-size:16px;" >
                <option value='funny'>funny</option>
                <option value='todayilearned'>todayilearned</option>
                <option value='science'>science</option>
                <option value='worldnews'>worldnews</option>
                <option value='gaming'>gaming</option>
                <option value='videos'>videos</option>
                <option value='movies'>movies</option>
                <option value='Music'>Music</option>
                <option value='aww'>aww</option>
                <option value='news'>news</option>
                <option value='explainlikeimfive'>explainlikeimfive</option>
                <option value='askscience'>askscience</option>
                <option value='EarthPorn'>EarthPorn</option>
                <option value='books'>books</option>
                <option value='television'>television</option>
                <option value='LifeProTips'>LifeProTips</option>
                <option value='mildlyinteresting'>mildlyinteresting</option>
                <option value='space'>space</option>
                <option value='Showerthoughts'>Showerthoughts</option>
                <option value='DIY'>DIY</option>
                <option value='Jokes'>Jokes</option>
                <option value='sports'>sports</option>
                <option value='gadgets'>gadgets</option>
                <option value='tifu'>tifu</option>
                <option value='InternetIsBeautiful'>InternetIsBeautiful</option>
                <option value='nottheonion'>nottheonion</option>
                <option value='photoshopbattles'>photoshopbattles</option>
                <option value='food'>food</option>
                <option value='history'>history</option>
                <option value='Futurology'>Futurology</option>
                <option value='Documentaries'>Documentaries</option>
                <option value='dataisbeautiful'>dataisbeautiful</option>
                <option value='personalfinance'>personalfinance</option>
                <option value='listentothis'>listentothis</option>
                <option value='UpliftingNews'>UpliftingNews</option>
                <option value='GetMotivated'>GetMotivated</option>
                <option value='OldSchoolCool'>OldSchoolCool</option>
                <option value='philosophy'>philosophy</option>
                <option value='Art'>Art</option>
                <option value='nosleep'>nosleep</option>
                <option value='creepy'>creepy</option>
                <option value='WritingPrompts'>WritingPrompts</option>
                <option value='TwoXChromosomes'>TwoXChromosomes</option>
                <option value='Fitness'>Fitness</option>
                <option value='technology'>technology</option>
                <option value='WTF'>WTF</option>
                <option value='bestof'>bestof</option>
                <option value='AdviceAnimals'>AdviceAnimals</option>
                <option value='politics'>politics</option>
                <option value='atheism'>atheism</option>
                <option value='europe'>europe</option>
                <option value='interestingasfuck'>interestingasfuck</option>
                <option value='woahdude'>woahdude</option>
                <option value='leagueoflegends'>leagueoflegends</option>
                <option value='pcmasterrace'>pcmasterrace</option>
                <option value='BlackPeopleTwitter'>BlackPeopleTwitter</option>
                <option value='gameofthrones'>gameofthrones</option>
                <option value='trees'>trees</option>
                <option value='reactiongifs'>reactiongifs</option>
                <option value='Unexpected'>Unexpected</option>
                <option value='Overwatch'>Overwatch</option>
                <option value='Android'>Android</option>
                <option value='oddlysatisfying'>oddlysatisfying</option>
                <option value='Games'>Games</option>
                <option value='programming'>programming</option>
                <option value='wholesomememes'>wholesomememes</option>
                <option value='nba'>nba</option>
                <option value='cringepics'>cringepics</option>
                <option value='facepalm'>facepalm</option>
                <option value='me_irl'>me_irl</option>
                <option value='relationships'>relationships</option>
                <option value='Frugal'>Frugal</option>
                <option value='pokemon'>pokemon</option>
                <option value='soccer'>soccer</option>
                <option value='lifehacks'>lifehacks</option>
                <option value='pokemongo'>pokemongo</option>
                <option value='ImGoingToHellForThis'>ImGoingToHellForThis</option>
                <option value='fffffffuuuuuuuuuuuu'>fffffffuuuuuuuuuuuu</option>
                <option value='tattoos'>tattoos</option>
                <option value='comics'>comics</option>
                <option value='malefashionadvice'>malefashionadvice</option>
                <option value='OutOfTheLoop'>OutOfTheLoop</option>
                <option value='StarWars'>StarWars</option>
                <option value='CrappyDesign'>CrappyDesign</option>
                <option value='YouShouldKnow'>YouShouldKnow</option>
                <option value='nfl'>nfl</option>   
                <option value='python'>python</option>                  
                <option value='financialindependence'>financialindependence</option>
                <option value='SideProject'>SideProject</option>
                <option value='Entrepreneur'>Entrepreneur</option>               
                </select>


                //<input style="text-align:center;width:265px !important;display:inline;padding-left:5px;margin-left:5px;border-radius:4px;height:43px" type='text', name='subreddits', id='subreddits', autofocus, required class="form-control" >

                <br>
                <br>
                p.paragraph(style='font-size:22px;line-height:1.5;color:#4f4c52;padding-top:5px;') 
                  | Your frequency
                <select name="frequency" id="frequency" style="width:265px;font-size:16px;padding-top:10px;padding-bottom:10px;height:43px;border-radius:4px !important;line-height:1.7 !important;box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075) !important;border: 1px solid #ccc !important;padding-left:5px;font-family: Avenir !important;" >
                <option value="Daily">Daily</option>
                <option value="Weekly">Weekly</option>
                <option value="Weekly">None (unsubscribe from emails)</option>
                </select>

   
              <br>
              <br>
              #signup_button2.btn.btn-md.btn-hover.btn-default(onclick='update_data()') Update






      br
      br

      //google analytics - storyrake
      script.
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-115904415-1', 'auto');
        ga('send', 'pageview');

        //**************************************************************************//
        //********************************SCRIPTS***********************************//
        //**************************************************************************//

        
  else
    if !user
      //jquery
      script(type='text/javascript', src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js')
      <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
      <link href="../css/select2.min.css" rel="stylesheet">

      script.
        $(document).ready(function() {
          $('.js-example-basic-single').select2({
            //sort the options
            sorter: function(data) {
                return data.sort(function (a, b) {
                    if (a.text > b.text) {
                        return 1;
                    }
                    if (a.text < b.text) {
                        return -1;
                    }
                    return 0;
                });
            }  
          })
        });


      
      .div
        br
        .col-md-6.col-md-offset-3(style='text-align:center;background-color:#f5f5f585;border-radius:15px;box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.11), 0 6px 20px 0 rgba(0, 0, 0, 0.1);')
          
          h3(style="font-weight:500 !important;color:#4f4c52 !important;padding-top:20px !important;") Join Storyrake
          
          form.form-horizontal(id='signup-form', action='/signup', method='POST')
            p.paragraph(style='font-size:23px;line-height:1.5;color:#341f97;padding-top:5px;text-align:center;') 
              | Enter your email address and favorite subreddits,
              br
              | receive a summary email with the top posts
            input(type='hidden', name='_csrf', value=_csrf)
            p.paragraph(style='font-size:22px;line-height:1.5;color:#4f4c52;padding-top:5px;') 
              | Select your favorite subreddits
              br
              | (you can always edit these later)  
            <select multiple="multiple" class="js-example-basic-single" name="subreddits" id="subreddits" style="width:265px;font-size:16px;" >
            <option value='funny'>funny</option>
            <option value='todayilearned'>todayilearned</option>
            <option value='science'>science</option>
            <option value='worldnews'>worldnews</option>
            <option value='gaming'>gaming</option>
            <option value='videos'>videos</option>
            <option value='movies'>movies</option>
            <option value='Music'>Music</option>
            <option value='aww'>aww</option>
            <option value='news'>news</option>
            <option value='explainlikeimfive'>explainlikeimfive</option>
            <option value='askscience'>askscience</option>
            <option value='EarthPorn'>EarthPorn</option>
            <option value='books'>books</option>
            <option value='television'>television</option>
            <option value='LifeProTips'>LifeProTips</option>
            <option value='mildlyinteresting'>mildlyinteresting</option>
            <option value='space'>space</option>
            <option value='Showerthoughts'>Showerthoughts</option>
            <option value='DIY'>DIY</option>
            <option value='Jokes'>Jokes</option>
            <option value='sports'>sports</option>
            <option value='gadgets'>gadgets</option>
            <option value='tifu'>tifu</option>
            <option value='InternetIsBeautiful'>InternetIsBeautiful</option>
            <option value='nottheonion'>nottheonion</option>
            <option value='photoshopbattles'>photoshopbattles</option>
            <option value='food'>food</option>
            <option value='history'>history</option>
            <option value='Futurology'>Futurology</option>
            <option value='Documentaries'>Documentaries</option>
            <option value='dataisbeautiful'>dataisbeautiful</option>
            <option value='personalfinance'>personalfinance</option>
            <option value='listentothis'>listentothis</option>
            <option value='UpliftingNews'>UpliftingNews</option>
            <option value='GetMotivated'>GetMotivated</option>
            <option value='OldSchoolCool'>OldSchoolCool</option>
            <option value='philosophy'>philosophy</option>
            <option value='Art'>Art</option>
            <option value='nosleep'>nosleep</option>
            <option value='creepy'>creepy</option>
            <option value='WritingPrompts'>WritingPrompts</option>
            <option value='TwoXChromosomes'>TwoXChromosomes</option>
            <option value='Fitness'>Fitness</option>
            <option value='technology'>technology</option>
            <option value='WTF'>WTF</option>
            <option value='bestof'>bestof</option>
            <option value='AdviceAnimals'>AdviceAnimals</option>
            <option value='politics'>politics</option>
            <option value='atheism'>atheism</option>
            <option value='europe'>europe</option>
            <option value='interestingasfuck'>interestingasfuck</option>
            <option value='woahdude'>woahdude</option>
            <option value='leagueoflegends'>leagueoflegends</option>
            <option value='pcmasterrace'>pcmasterrace</option>
            <option value='BlackPeopleTwitter'>BlackPeopleTwitter</option>
            <option value='gameofthrones'>gameofthrones</option>
            <option value='trees'>trees</option>
            <option value='reactiongifs'>reactiongifs</option>
            <option value='Unexpected'>Unexpected</option>
            <option value='Overwatch'>Overwatch</option>
            <option value='Android'>Android</option>
            <option value='oddlysatisfying'>oddlysatisfying</option>
            <option value='Games'>Games</option>
            <option value='programming'>programming</option>
            <option value='wholesomememes'>wholesomememes</option>
            <option value='nba'>nba</option>
            <option value='cringepics'>cringepics</option>
            <option value='facepalm'>facepalm</option>
            <option value='me_irl'>me_irl</option>
            <option value='relationships'>relationships</option>
            <option value='Frugal'>Frugal</option>
            <option value='pokemon'>pokemon</option>
            <option value='soccer'>soccer</option>
            <option value='lifehacks'>lifehacks</option>
            <option value='pokemongo'>pokemongo</option>
            <option value='ImGoingToHellForThis'>ImGoingToHellForThis</option>
            <option value='fffffffuuuuuuuuuuuu'>fffffffuuuuuuuuuuuu</option>
            <option value='tattoos'>tattoos</option>
            <option value='comics'>comics</option>
            <option value='malefashionadvice'>malefashionadvice</option>
            <option value='OutOfTheLoop'>OutOfTheLoop</option>
            <option value='StarWars'>StarWars</option>
            <option value='CrappyDesign'>CrappyDesign</option>
            <option value='YouShouldKnow'>YouShouldKnow</option>
            <option value='nfl'>nfl</option>
            <option value='python'>python</option>                  
            <option value='financialindependence'>financialindependence</option>
            <option value='SideProject'>SideProject</option>
            <option value='Entrepreneur'>Entrepreneur</option>

            </select>

            p.paragraph(style='font-size:22px;line-height:1.5;color:#4f4c52;') 
              <br>
              | How often do you want a summary?
            <select name="frequency" id="frequency" style="width:265px;font-size:16px;padding-top:10px;padding-bottom:10px;height:43px;border-radius:4px !important;line-height:1.7 !important;box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075) !important;border: 1px solid #ccc !important;padding-left:5px;font-family: Avenir !important;" >
            <option value="Daily">Daily</option>
            <option value="Weekly">Weekly</option>
            </select>
            p.paragraph(style='font-size:22px;line-height:1.5;color:#4f4c52;') 
              <br>
              | Enter your email    
            
            <input style="text-align:center;width:265px !important;display:inline;padding-left:5px;margin-left:5px;border-radius:4px;height:43px" type='email', name='email', id='email', placeholder='Email', autofocus, required class="form-control" >

            p.paragraph(style='font-size:22px;line-height:1.5;color:#4f4c52;') 
              <br>
              | Enter your password    
            
            <input style="text-align:center;width:265px !important;display:inline;padding-left:5px;margin-left:5px;border-radius:4px;height:43px" type='password', name='password', id='password', placeholder='Password' class="form-control" >
        
          <br>
          

          #signup_button2.btn.btn-md.btn-hover.btn-default(onclick='signup()') Sign up
          <br>
          <br>
          <br>
      </div>
      br
      br
      #landing.container
        .row
          .col-md-1
          .col-md-5
            
            h3(style="font-weight:500 !important;color:#341f97 !important;padding-top:20px !important;font-size:30px;padding-bottom:10px;")
              | How it works
            p.paragraph(style='font-size:22px;line-height:1.5;color:#71828c;padding-top:5px')
              
              span ✔ 
              | Select your favorite subreddits
              br
              br
              span ✔ 
              | Choose how often you'd like to receive an email summary
              br
              br            
              span ✔ 
              | We'll search (ahem, 'rake') through your subreddits and collect the top stories
              br
              br
              span ✔ 
              | You'll receive a personalized Reddit summary in your inbox
              br
              
              br
              br
            
          
          .col-md-5
            br
            br
            img.img-fluid(src='/images/rake_subreddits.png', alt='Mescale', style='max-width:60%;height:auto;border:none;text-align: center;')
            
          .col-md-1

          // End mc_embed_signup  
      //.background_image(style='background-image: url(/800_600_background.png);height:100%;background-repeat: no-repeat;padding-top:-100px;background-size:100%')  
      //p.paragraph(style='font-size:20px;line-height:1.5;color:#4f4c52;')
        br
        span Creators
        br
        | Want to be added to our site?
        br
        | Submit your info
      //#signup_button.btn.btn-md.btn-hover.btn-default(onclick="location.href='/records'") Get started

      script.
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-115904415-1', 'auto');
        ga('send', 'pageview');

      script.
        function signup() {
        document.getElementById("signup-form").submit();
        }



        window.onload = function start(){
        //allow submitting with enter key - Signup Form
        $('#signup-form').keydown(function(e) {
        var key = e.which;
        if (key == 13) {
        // As ASCII code for ENTER key is "13"
        document.getElementById("signup-form").submit();
        }
        });
        }
